<!DOCTYPE html>

<!-- Sample implementation of a chat:configuration module -->

<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CRM Configuration</title>

    <!-- Import AtlasKit: https://atlaskit.atlassian.com -->
    <link rel="stylesheet" href="node_modules/@atlaskit/css-reset/dist/bundle.css" />
    <link rel="stylesheet" href="node_modules/@atlaskit/reduced-ui-pack/dist/bundle.css" />

    <!-- specific css -->
    <link rel="stylesheet" href="ce-style.css">

    <!-- Import JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Import the Stride Javascript API -->
    <script src='https://dev-lib.stride.com/javascript/simple-xdm.js'></script>

    <script>
        $(document).ready(function() {

            /**
             * Load configuration settings from the app backend for this conversation
             */
            AP.auth.withToken(function(err, token) {
                $.ajax({
                    type: 'GET',
                    url: '/module/config/content',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    dataType: 'json',
                    success: function(data) {
                        var notificationLevel = data.notificationLevel;
                        switch (notificationLevel) {
                            case "INSTANT":
                                $("#option1").prop("checked", true);
                                break;
                            case "DAILY":
                                $("#option2").prop("checked", true);
                                break;
                            default:
                                $("#option3").prop("checked", true);
                        }
                    },
                    error: function(data) {
                        console.log(data);
                    }
                });
            });

            /**
             * Call the app backend to save configuration settings when the user clicks on the "Save" action
             */
            AP.register({
                "dialog-button-clicked": function(event, closeDialog) {
                    if (event.action === "action-save") {

                        //events are currently processed synchronously in the JavaScript API. Using this makes sure the dialog
                        //doesn't close before the AJAX call completes
                        closeDialog(false);

                        var notificationLevel = $("input[id=option1]:checked").val() ? "INSTANT" :
                            $("input[id=option2]:checked").val() ? "DAILY" : "NONE";

                        AP.auth.withToken(function(err, token) {
                            $.ajax({
                                type: 'POST',
                                url: '/module/config/content',
                                headers: {
                                    'Authorization': 'Bearer ' + token
                                },
                                data: {
                                    'notificationLevel': notificationLevel
                                },
                                dataType: 'json',
                                success: function(data) {
                                    console.log("saved settings");
                                    AP.dialog.close();
                                },
                                error: function(data) {
                                    console.log("Error" + data);
                                }
                            });
                        });

                    }
                    if (event.action === "action-close") {
                        console.log("closing dialog")
                    }
                }
            })
        });

        function connectToProvider() {
            AP.auth.withToken(function(err, token) {
                window.open("/login/salesforce?jwt=" + token);
            });
        }
    </script>
</head>

<body>
    <img src="https://login.salesforce.com/img/logo198.png" width="80">
    <p>
        Please use the below link to log in to Salesforce. After you're done, please close this dialog!
    </p>
    <div class="ak-button-group">
        <input type="button" class="ak-button" name="connect" value="Connect to Salesforce" id="connect1" onclick="connectToProvider()">
    </div>

    
    <div class="ak-field-group object-label">
      <label for="object">Objects</label>
    </div>

    <ul class="mapping-list">
      <li width="300">
          <span class="object-name">Leads</span>
          <span class="mapping-actions">
              edit <svg focusable="false" class="icon edit-button"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ak-icon-editor/edit"></use></svg>
              <svg focusable="false" class="icon done-button"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ak-icon-check-circle"></use></svg>
              del <svg focusable="false" class="icon remove-button"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#ak-icon-editor/remove"></use></svg>
          </span>
          <div class="notification-group-container">
            <ul class="clearfix group-item">
                <li class="ak-field-checkbox">
                    <input type="checkbox" class="notification-item" id="Leads_Create" data-id="create" checked="">
                    <label for="Leads_Create">Create</label>
                </li>
                <li class="ak-field-checkbox">
                    <input type="checkbox" class="notification-item" id="Leads_update" data-id="update" checked="">
                    <label for="Leads_update">Update</label>
                </li>
            </ul>
          </div>
            <div class="notification-group-container">
                <p>Notify room with activity from:</p>
                <ul class="notification-group-list">
                    <li class="clearfix group-item">
                      <h2>Pull requests</h2>
                      <ul class="notification-list clearfix">
                          <li class="ak-field-checkbox">
                            <input type="checkbox" class="notification-item" id="Leads__pullrequest_fulfilled" data-id="pullrequest:fulfilled" checked="">
                            <label for="Leads__pullrequest_fulfilled">Merged</label>
                          </li>
                          <li class="ak-field-checkbox">
                            <input type="checkbox" class="notification-item" id="Leads__pullrequest_approved" data-id="pullrequest:approved" checked="">
                            <label for="Leads__pullrequest_approved">Approved</label>
                          </li>
                          <li class="ak-field-checkbox">
                            <input type="checkbox" class="notification-item" id="Leads__pullrequest_unapproved" data-id="pullrequest:unapproved" checked="">
                            <label for="Leads__pullrequest_unapproved">Unapproved</label>
                          </li>
                          <li class="ak-field-checkbox">
                            <input type="checkbox" class="notification-item" id="Leads__pullrequest_rejected" data-id="pullrequest:rejected">
                            <label for="Leads__pullrequest_rejected">Declined</label>
                          </li>
                          <li class="ak-field-checkbox">
                            <input type="checkbox" class="notification-item" id="Leads__pullrequest_comment_created" data-id="pullrequest:comment_created">
                            <label for="Leads__pullrequest_comment_created">Commented</label>
                          </li>
                          <li class="ak-field-checkbox">
                            <input type="checkbox" class="notification-item" id="Leads__pullrequest_created" data-id="pullrequest:created" checked="">
                            <label for="Leads__pullrequest_created">Created</label>
                          </li>
                      </ul>
                    </li>
                </ul>
              </div>
      </li>
      <!--
      <li>
        <span class="object-name">Accounts</span>
        <span class="mapping-actions"></span>
      </li>
      <li>
        <span class="object-name">Opportunities</span>
        <span class="mapping-actions"></span>
      </li>
      <li>
        <span class="object-name">Contacts</span>
        <span class="mapping-actions"></span>
      </li>
    -->
      
    </ul>

</body>

</html>